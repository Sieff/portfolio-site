# Stage 1: Build the Next.js app
FROM node:20-alpine AS builder

WORKDIR /app

# Install dependencies
COPY ./packages/backend/package.json ./packages/backend/
COPY ./packages/backend/src/ ./packages/backend/src/
COPY ./packages/backend/tsconfig.json ./packages/backend/tsconfig.json
COPY ./packages/backend/webpack.config.js ./packages/backend/webpack.config.js
COPY tsconfig.json ./
COPY ./packages/shared/package.json ./packages/shared/
COPY ./packages/shared/src/ ./packages/shared/src/
COPY package.json ./
COPY package-lock.json ./
RUN npm ci

# Start the Next.js server
WORKDIR /app/packages/backend
CMD ["npm", "start"]


